/*! jetzt 2023-02-27
* https://krmbzds.github.io/jetzt/
* Copyright (c) 2023 David Sheldrick and contributors; Licensed Apache 2.0 */
!function(e){void 0!==e.jetzt?console.warn("jetzt unable to initialize, window.jetzt already set"):e.jetzt={}}(this),function(e){var e=e.jetzt,a={};function n(e,t,r){var n=[];0<=e.className.trim().length&&(n=e.className.split(/\s+/)),t.split(/\s+/).forEach(function(e){r(n,e)}),e.className=n.join(" ")}(e.helpers=a).removeFromArray=function(e,t){t=e.indexOf(t);-1<t&&e.splice(t,1)},a.getScrollTop=function(){return document.body.scrollTop||document.documentElement.scrollTop},a.getScrollLeft=function(){return document.body.scrollLeft||document.documentElement.scrollLeft},a.elem=function(e,t,r){var n=document.createElement(e);return n.className=t||"",r&&r.forEach(function(e){n.appendChild(e)}),n},a.div=function(e,t){return a.elem("div",e,t)},a.span=function(e,t){return a.elem("span",e,t)},a.addClass=function(e,t){n(e,t,function(e,t){a.removeFromArray(e,t),e.push(t)})},a.removeClass=function(e,t){n(e,t,a.removeFromArray)},a.hasClass=function(e,t){var r=!0;return n(e,t,function(e,t){r=r&&-1<e.indexOf(t)}),r},a.realTypeOf=function(e){return Object.prototype.toString.call(e).slice(8,-1)},a.flatten=function(e){var r=[];return function e(t){"[object Array]"===Object.prototype.toString.call(t)?t.forEach(e):r.push(t)}(e),r},a.clamp=function(e,t,r){return Math.min(Math.max(t,e),r)},a.recursiveExtend=function(){for(var e=arguments[0],t=1;t<arguments.length;t++){var r,n,o,s=arguments[t];for(r in s)s.hasOwnProperty(r)&&(e.hasOwnProperty(r)?(n=e[r],o=s[r],"Object"===a.realTypeOf(n)&&"Object"===a.realTypeOf(o)?e[r]=a.recursiveExtend({},n,o):e[r]=o):e[r]=s[r])}return e},a.keys=function(e){var t,r=[];for(t in e)e.hasOwnProperty(t)&&r.push(t);return r},a.clone=function(e){return JSON.parse(JSON.stringify(e))}}(this),function(o){var e=o.jetzt,i=e.helpers,s=[{name:"Classic",dark:{backdrop_opacity:"0.86",colors:{backdrop:"#000000",background:"#303030",foreground:"#E0E0E0",message:"#909090",pivot:"#73b5ee",progress_bar_background:"#000000",progress_bar_foreground:"#3a5566",reticle:"#656565",wrap_background:"#404040",wrap_foreground:"#a1a1a1"}},light:{backdrop_opacity:"0.07",colors:{backdrop:"black",background:"#fbfbfb",foreground:"#333333",message:"#929292",pivot:"#E01000",progress_bar_background:"black",progress_bar_foreground:"#00c00a",reticle:"#efefef",wrap_background:"#f1f1f1",wrap_foreground:"#666"}}}],t={config_version:0,target_wpm:500,scale:1,dark:!0,selected_theme:1,show_message:!1,strip_citation:!1,selection_color:"#FF0000",modifiers:{normal:1,start_clause:1,end_clause:1.8,start_sentence:1.3,end_sentence:2.2,start_paragraph:2,end_paragraph:2.8,short_space:1.5,long_space:2.2},font_family:"Menlo, Monaco, Consolas, monospace",font_weight:"normal",custom_themes:[]},c=i.clone(t),r=[];function l(){r.forEach(function(e){e()})}var n="jetzt_options",a={get:function(e){var t=localStorage.getItem(n);e(t&&"{}")},set:function(e){localStorage.setItem(n,e)}};function u(){a.set(JSON.stringify(c))}function f(e,t){if("string"==typeof e&&(e=[e]),1===arguments.length)return function e(t,r){if(0===r.length)throw new Error("No keys specified.");var n=r[0];return 1===r.length?(t.hasOwnProperty(n)||console.warn("config lookup: no key '"+n+"'"),t[n]):(t=t[n],"Object"===i.realTypeOf(t)?e(t,r.slice(1)):void console.warn("config lookup: no key '"+n+"'"))}(c,e);var r=c,n=e,o=t;if(0===n.length)throw new Error("No keys specified.");var s,a=n[0];1===n.length?r[a]=o:(s=r[a],"Object"!==i.realTypeOf(s)&&(r[a]=s={}),_put(s,n.slice(1),o)),u(),l()}(e.config=f).DEFAULTS=i.clone(t),f.DEFAULT_THEMES=i.clone(s),f.onChange=function(e){return r.push(e),function(){i.removeFromArray(r,e)}},f.setBackend=function(e){a=e,this.refresh(),l()},f.refresh=function(n){a.get(function(e){try{var r=JSON.parse(e||"{}"),t=!1;0!=r.config_version&&(r.custom_themes&&i.keys(r.custom_themes).forEach(function(e){var t=r.custom_themes[e];r.custom_themes[e]=i.recursiveExtend(s.Classic,t)}),t=!(r.config_version=0)),i.recursiveExtend(c,r),o.jazz=c,t&&u(),l()}catch(e){throw new Error("corrupt config json",e)}n&&n()})},f.getSelectedTheme=function(){return s[c.selected_theme]||s[0]},f.maxModifier=function(e,t){return this(["modifiers",e])>this(["modifiers",t])?e:t},f.adjustWPM=function(e){c.target_wpm=i.clamp(100,c.target_wpm+e,1500),l(),u()},f.adjustScale=function(e){this("scale",i.clamp(0,c.scale+e,1))},f.save=function(){u()},f.refresh()}(this),function(a){var e=a.jetzt,i=e.helpers,c=e.config;function l(e){return 13<e.length||9<e.length&&-1<e.indexOf("-")}function u(e){if(l(e)){var t=[],r=e.indexOf("-");if(0<r&&r<e.length-1)return t.push(e.substr(0,r)),t.push(e.substr(r+1)),i.flatten(t.map(u));for(var n=Math.ceil(e.length/8),o=Math.ceil(e.length/n);n--;)t.push(e.substr(0,o)),e=e.substr(o);return t}return[e]}var f=new RegExp("\\s?(\\(((((((\\S\\.\\s)?(\\S+\\s)?\\S+?),\\s)*((\\S\\.\\s)?(\\S+\\s)?\\S+?),?\\s(and|&)\\s)?((\\S\\.\\s)?(\\S+\\s)?\\S+?)(,?\\set\\sal\\.?)|(((((\\S\\.\\s)?(\\S+\\s)?\\S+?),\\s)*((\\S\\.\\s)?(\\S+\\s)?\\S+?),?\\s(and|&)\\s)?((\\S\\.\\s)?(\\S+\\s)?\\S+?)(,?\\set\\sal\\.?)?,?\\s)?(((16|17|18|19|20)\\d{2}[a-z]?)|([a-z]{1,4}\\.\\s\\d+))((,\\s|:)(([a-z]{1,4}\\.\\s\\d+)|\\d+))*)(;|,|,?\\s(and|&))\\s)*(((((\\S\\.\\s)?(\\S+\\s)?\\S+?),\\s)*((\\S\\.\\s)?(\\S+\\s)?\\S+?),?\\s(and|&)\\s)?((\\S\\.\\s)?(\\S+\\s)?\\S+?)(,?\\set\\sal\\.?)|(((((\\S\\.\\s)?(\\S+\\s)?\\S+?),\\s)*((\\S\\.\\s)?(\\S+\\s)?\\S+?),?\\s(and|&)\\s)?((\\S\\.\\s)?(\\S+\\s)?\\S+?)(,?\\set\\sal\\.?)?,?\\s)?(((16|17|18|19|20)\\d{2}[a-z]?)|([a-z]{1,4}\\.\\s\\d+))((,\\s|:)(([a-z]{1,4}\\.\\s\\d+)|\\d+))*)\\)|\\[\\d+\\])","g");function d(){function r(e){return e.leftWrap=t.map(function(e){return e.left}).join(""),e.rightWrap=t.map(function(e){return e.right}).reverse().join(""),e}var n=[],o="normal",t=[],s=null;this.modNext=function(e){o=c.maxModifier(o,e)},this.modPrev=function(e){var t;0<n.length&&(t=n[n.length-1].modifier,n[n.length-1].modifier=c.maxModifier(t,e))},this.decPrev=function(e){0<n.length&&(n[n.length-1].decorator,n[n.length-1].decorator+=e)},this.pushWrap=function(e){t.push(e)},this.popWrap=function(e){-1<t.lastIndexOf(e)&&t.splice(t.lastIndexOf(e),t.length)},this.clearWrap=function(e){t=[]};this.spacer=function(){s?s.modifier="long_space":s=r({token:"   ",modifier:"short_space",decorator:""})},this.token=function(e){s&&n.push(s);var e=l(e)?u(e):[e],t=e.pop();e.forEach(function(e){n.push(r({token:e,modifier:"normal",decorator:"-"}))}),n.push(r({token:t,modifier:o,decorator:""})),o="normal",s=null},this.getInstructions=function(){return n}}var p={left:"«",right:"»"},h={left:"“",right:"”"},g={left:"(",right:")"},m={left:"#",right:""},y={left:"›",right:""};function v(e,t){var r=t||new d,n=null;if("Array"===i.realTypeOf(e))n=e;else{n=e.childNodes;if([].reduce.call(n,function(e,t){return e&&(1!==t.nodeType||!!a.getComputedStyle(t).display.match(/^inline/))},!0))return 0<(t=e.textContent.trim()).length&&_(t,r),r.getInstructions()}for(var o=null,s=0;s<n.length;s++)switch((o=n[s]).nodeName){case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":r.clearWrap(),r.pushWrap(m),r.modNext("start_paragraph"),v(o,r),r.spacer(),r.popWrap(m),r.modPrev("end_paragraph");break;case"BLOCKQUOTE":r.pushWrap(y),r.modNext("start_paragraph"),v(o,r),r.popWrap(y),r.modPrev("end_paragraph");break;case"SCRIPT":break;case"#text":0<o.textContent.trim().length&&_(o.textContent.trim(),r);break;case"DL":case"OL":case"UL":case"SECTION":case"P":r.modNext("start_paragraph"),v(o,r),r.modPrev("end_paragraph");break;case"#comment":break;default:v(o,r)}return r.getInstructions()}function _(e,t){for(var r=(e=c("strip_citation")?e.replace(f,""):e).match(/["«»“”\(\)\/–—]|--+|\n+|[^\s"“«»”\(\)\/–—]+/g),n=(null===r&&(r=[]),t||new d),o=!1,s=0;s<r.length;s++){var a=r[s];switch(a){case"“":n.spacer(),n.pushWrap(h),n.modNext("start_clause");break;case"”":n.popWrap(h),n.modPrev("end_clause"),n.spacer();break;case"«":n.spacer(),n.pushWrap(p),n.modNext("start_clause");break;case"»":n.popWrap(p),n.modPrev("end_clause"),n.spacer();break;case'"':o?(n.popWrap(h),n.spacer(),n.modNext("start_clause")):(n.spacer(),n.pushWrap(h),n.modPrev("end_clause")),o=!o;break;case"(":n.spacer(),n.pushWrap(g),n.modNext("start_clause");break;case")":n.popWrap(g),n.modPrev("end_clause"),n.spacer();break;default:a.match(/^(\/|--+|—|–)$/)?(n.modNext("start_clause"),n.token(a),n.modNext("start_clause")):a.match(/^[.?!…]+$/)?(n.decPrev(a),n.modPrev("end_sentence")):a.match(/[.?!…]+$/)?(n.modNext("end_sentence"),n.token(a),n.modNext("start_sentence")):a.match(/^[,;:]$/)?(n.decPrev(a),n.modPrev("end_clause")):a.match(/[,;:]$/)?(n.modNext("end_clause"),n.token(a),n.modNext("start_clause")):a.match(/\n+/)?(1<a.length||0<s&&r[s-1].match(/[.?!…'"”]+$/))&&(n.clearWrap(),n.modPrev("end_paragraph"),n.spacer(),n.modNext("start_paragraph"),o=!1):a.match(/^".+$/)?(o=!0,n.modNext("start_clause"),n.token(a.substr(1))):n.token(a)}}return n.getInstructions()}function t(e,t){var r=new d;return e(t,r),r.getInstructions()}e.parse={string:function(e){return t(_,e)},dom:function(e){return t(v,e)}}}(this),function(e){var l=e.jetzt,u=l.config;var f={start_sentence:!0,start_paragraph:!0};function t(r){var t,n=l.view.reader,o=!1,s=0;function a(e){var t;void 0===e&&(e=s<r.length?r[s]:r[r.length-1]),n.setWord(e.token,e.decorator),n.setWrap(e.leftWrap,e.rightWrap),n.setProgress(s/r.length*100),1===s?(e=Math.round((new Date).getTime()/1e3),n.started=e):s===r.length?(e=r.length,t=Math.round((new Date).getTime()/1e3)-n.started,n.setMessage(e+" words in "+t+"s")):s%5==0&&(e=r.length,e=(Math.round((new Date).getTime()/1e3)-n.started)*(e-s)/s,n.setMessage(Math.round(e)+"s left"))}function i(e){a(e),c(function(e){var t=6e4/u("target_wpm");if("normal"!==e.modifier)return t*u(["modifiers",e.modifier]);var r=1;switch(e.token.length){case 6:case 7:r=1.2;break;case 8:case 9:r=1.4;break;case 10:case 11:r=1.8;break;case 12:case 13:r=2}return t*r}(e))}function c(e){t=setTimeout(function(){o&&s<r.length?i(r[s++]):o=!1},e)}this.start=function(){s===r.length&&(s=0),o=!0,c(0)},this.stop=function(){clearTimeout(t),o=!1},this.toggleRunning=function(e){e!==o&&(o?this.stop():this.start())},this.prevSentence=function(){for(s=Math.max(0,s-5);0<s&&!f[r[s].modifier];)s--;o||a()},this.nextSentence=function(){for(s=Math.min(s+1,r.length-1);s<r.length-1&&!f[r[s].modifier];)s++;o||a()},this.prevParagraph=function(){for(s=Math.max(0,s-5);0<s&&"start_paragraph"!=r[s].modifier;)s--;o||a()},this.nextParagraph=function(){for(s=Math.min(s+1,r.length-1);s<r.length-1&&"start_paragraph"!=r[s].modifier;)s++;o||a()}}l.exec=function(e){return new t(e)}}(this),function(v){var e,t=v.jetzt,_=t.config,k=t.helpers,b=k.div,w=k.span,r={};function n(){function r(){m.tabIndex=0,m.focus()}var t,n=b("sr-backdrop"),o=b("sr-wpm"),s=b("sr-wrap sr-left"),a=b("sr-wrap sr-right"),i=w(),c=w(),l=w("sr-pivot"),u=w("sr-decorator"),f=b("sr-word",[i,l,c,u]),d=b("sr-progress"),p=b("sr-message"),h=b("sr-reticle"),g=b("sr-word-box",[h,d,p,f,o]),m=b("sr-reader",[s,g,a]),y=b("sr-reader-wrapper",[m]);m.onkeyup=m.onkeypress=function(e){if(!e.ctrlKey&&!e.metaKey)return e.stopImmediatePropagation(),!1};this.onBackdropClick=function(e){n.onclick=e},this.onKeyDown=function(e){m.onkeydown=e},this.dark=!1,this.applyConfig=function(){this.dark=_("dark"),this.applyTheme(_.getSelectedTheme()),this.setScale(_("scale")),this.setWPM(_("target_wpm")),this.setFont(_("font_family")),this.setFontWeight(_("font_weight")),_("show_message")?this.showMessage():this.hideMessage()},this.appendTo=function(e){e.appendChild(n),e.appendChild(y),y.offsetWidth,k.addClass(y,"in")},this.watchConfig=function(){var e=this;t=_.onChange(function(){e.applyConfig()})},this.unwatchConfig=function(){t&&t()},this.show=function(e){this.appendTo(document.body),this.applyConfig(),this.watchConfig();var t=k.getScrollTop();r(),document.body.scrollTop=t,document.documentElement.scrollTop=t,m.onblur=r,v.onfocus=function(){setTimeout(r,100)},"function"==typeof e&&v.setTimeout(e,340)},this.hide=function(e){t(),m.onblur=null,m.blur(),n.style.opacity=0,k.removeClass(y,"in"),v.setTimeout(function(){n.remove(),y.remove(),"function"==typeof e&&e()},340)},this.setScale=function(e){y.style.webkitTransform="translate(-50%, -50%) scale("+e+")",y.style.mozTransform="translate(-50%, -50%) scale("+e+")",y.style.transform="translate(-50%, -50%) scale("+e+")"},this.setWPM=function(e){o.innerHTML=e+""},this.setFont=function(e){i.style.fontFamily=e,l.style.fontFamily=e,c.style.fontFamily=e,u.style.fontFamily=e,s.style.fontFamily=e,a.style.fontFamily=e,o.style.fontFamily=e,p.style.fontFamily=e},this.setFontWeight=function(e){i.style.fontWeight=e,l.style.fontWeight=e,c.style.fontWeight=e,u.style.fontWeight=e},this.applyTheme=function(e){var e=this.dark?e.dark:e.light,t=e.colors;n.offsetWidth,n.style.opacity=e.backdrop_opacity,n.style.backgroundColor=t.backdrop,g.style.backgroundColor=t.background,i.style.color=t.foreground,c.style.color=t.foreground,s.style.backgroundColor=t.wrap_background,a.style.backgroundColor=t.wrap_background,s.style.color=t.wrap_foreground,a.style.color=t.wrap_foreground,h.style.borderColor=t.reticle,l.style.color=t.pivot,u.style.color=t.message,d.style.borderColor=t.progress_bar_foreground,d.style.backgroundColor=t.progress_bar_background,p.style.color=t.message,o.style.color=t.message},this.setProgress=function(e){d.style.borderLeftWidth=Math.ceil(4*e)+"px"},this.setMessage=function(e){p.innerHTML=e},this.showMessage=function(){p.style.display="block"},this.hideMessage=function(){p.style.display="none"},this.started=!1,this.setWord=function(e,t){var r=(r=(r=e.replace(/[?.,!:;*-]+$/,"")).length)<2?0:r<6?1:r<10?2:r<14?3:4,e=(i.innerHTML=e.substr(0,r),l.innerHTML=e.substr(r,1),c.innerHTML=e.substr(1+r),void 0!==t&&(u.innerHTML=t),f.offsetWidth,h.offsetLeft+h.offsetWidth/2);f.style.left=e-l.offsetLeft-l.offsetWidth/2+"px"},this.setWrap=function(e,t){s.innerHTML=e,a.innerHTML=t;e=s.offsetWidth,t=a.offsetWidth;y.style.paddingLeft="50px",y.style.paddingRight="50px",t<e?y.style.paddingRight=e-t+50+"px":e<t&&(y.style.paddingLeft=t-e+50+"px")},this.clear=function(){this.setWrap("",""),this.setWord("   ","")}}(t.view=r).Reader=n,r.__defineGetter__("reader",function(){return e=e||new n});var o=[];r.addOverlay=function(e){var t=e.getBoundingClientRect(),r=k.div("sr-overlay");return r.style.top=k.getScrollTop()+t.top+"px",r.style.left=k.getScrollLeft()+t.left+"px",r.style.width=t.width+"px",r.style.height=t.height+"px",r.style.backgroundColor=_("selection_color"),document.body.appendChild(r),e.___jetztOverlay=r,o.push(e),t.top<v.innerHeight},r.removeOverlay=function(e){e.___jetztOverlay&&(e.___jetztOverlay.remove(),delete e.___jetztOverlay,k.removeFromArray(o,e))},r.removeAllOverlays=function(){for(var e=o.length;e--;){var t=o[e];t.___jetztOverlay.remove(),delete t.___jetztOverlay}o=[]},r.highlightRange=function(e){}}(this),function(r){var p=r.jetzt,h=p.helpers;function g(e,t){r.addEventListener(e,t)}function m(e,t){r.removeEventListener(e,t)}function t(){function t(e){p.view.removeAllOverlays(),o=e,a()}function r(e){for(var t=e,r=e.parentNode;r&&!c[r.tagName];)r=(t=r).parentNode;if(r){for(var n=r.childNodes,o=n.length,s=[],a=0;n[a]!==t;)a++;for(;a<o;a++){var i=n[a];l[i.tagName]&&s.push(i)}return s}return[e]}function n(){p.view.removeAllOverlays(),m("mouseover",i),m("mousemove",u),m("keydown",f),m("keyup",d),m("click",e),s&&h.removeClass(s,"sr-pointer")}var o=[],s=null,a=function(){overlays=[];for(var e=0,t=o.length;e<t&&p.view.addOverlay(o[e]);e++);},c={DIV:!0,ARTICLE:!0,BLOCKQUOTE:!0,MAIN:!0,SECTION:!0,UL:!0,OL:!0,DL:!0},l={P:!0,H1:!0,H2:!0,H3:!0,H4:!0,H5:!0,H6:!0,SPAN:!0,DL:!0,OL:!0,UL:!0,BLOCKQUOTE:!0,SECTION:!0},i=function(e){s&&h.removeClass(s,"sr-pointer"),h.addClass(e.target,"sr-pointer"),s=e.target,e.altKey?t([e.target]):t(r(e.target))},e=function(e){n(),p.init(p.parse.dom(o))},u=function(e){i(e),m("mousemove",u)},f=function(e){27===e.keyCode?n():e.altKey&&1<o.length&&t([o[0]])},d=function(e){e.altKey||1!==o.length||t(r(o[0]))};g("mouseover",i),g("click",e),g("mousemove",u),g("keydown",f),g("keyup",d)}p.select=function(e){e=void 0===e?r.getSelection().toString():e.selectionText;0<e.trim().length?(p.init(p.parse.string(e)),r.getSelection().removeAllRanges()):t()}}(this),function(e){var r=e.jetzt,n=(r.helpers,r.config),t={};function o(e){e.preventDefault(),e.stopImmediatePropagation()}(r.control=t).keyboard=function(t){r.view.reader.onKeyDown(function(e){if(!e.ctrlKey&&!e.metaKey)switch(e.keyCode){case 27:o(e),r.quit();break;case 38:o(e),n.adjustWPM(10);break;case 40:o(e),n.adjustWPM(-10);break;case 37:o(e),e.altKey?t.prevParagraph():t.prevSentence();break;case 39:o(e),e.altKey?t.nextParagraph():t.nextSentence();break;case 32:o(e),t.toggleRunning();break;case 187:case 107:case 61:o(e),n.adjustScale(.1);break;case 109:case 189:case 173:o(e),n.adjustScale(-.1);break;case 48:o(e),n("dark",!n("dark"));break;case 191:o(e),n("show_message",!n("show_message"))}})},e.addEventListener("keydown",function(e){!r.isOpen()&&e.altKey&&83===e.keyCode&&(e.preventDefault(),r.select())})}(this),function(e){var t,r=e.jetzt,n=r.view.reader;r.init=function(e){if(t)throw new Error("jetzt already initialised");n.clear(),t=r.exec(e),r.control.keyboard(t),n.show(),n.onBackdropClick(r.quit),setTimeout(function(){t.start()},500)},r.quit=function(){t.stop(),n.hide(),t=null},r.isOpen=function(){return!!t}}(this);